@{
    ViewData["Title"] = "Home Page";
}

@section scripts{
    <script>
        var app = new Vue({
            el: '#driver-list',
            data: {
                title: 'Drivera list',
                loading: true,
                signalrConnection: "",
                drivers: []
            },
            created: function () {
                console.log('created');
                this.signalrConnection = new signalR.HubConnectionBuilder()
                    .withUrl("/messagebroker")
                    .build();
                this.signalrConnection.start().then(function () {
                    console.log("SignalR Hub Connected");
                }).catch(function (err) {
                    return console.error(err.toString());
                });

                //var thisVue = this;
                //thisVue.signalrConnection.on("onDriverRecived", function (driver) {
                //    debugger;
                //    console.log(driver);
                //    console.log(thisVue.drivers);

                //});
            },
            mounted: function () {
                console.log('mounted');

                var thisVue = this;
                thisVue.signalrConnection.on("onDriverRecived", function (driver) {
                    debugger;
                    console.log(driver);
                    thisVue.drivers.push(driver);


                });

                fetch('/api/drivers')
                    .then((res) => res.json())
                    .then((data) => {
                        console.log(data);
                        this.drivers = data;
                        this.loading = false;
                    });
            },
            methods: {
                onNewDriver: function (driver) {
                    this.drivers.push(driver);
                }
            }

        });
    </script>
}
<div id="app" class="container">
   
    <div class="columns" id="driver-list">
        <div v-if="loading">
            <div class="pageloader is-bottom-to-top is-active"><span class="title">Pageloader</span></div>
        </div>
        <div v-if="drivers.length > 0">
            <table class="table">
                <tr v-for="driver in drivers">
                    <td> {{driver.name}}-{{driver.family}}</td>
                </tr>
            </table>
        </div>
    </div>
</div>



